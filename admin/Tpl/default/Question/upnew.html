<include file="Public:header" />
<style type="text/css"> table {font-size: 12px} </style>
<div style="margin-left: 10px;"><span style="font-size:14px;color:blue;font-weight: bold;line-height:30px;">批量上传题目信息：</span></div>
<div class="data_top">
    <!--<form id="addExcel" action="do.php?action=import" method="post" enctype="multipart/form-data">-->
    <form id="addExcel" action="admin.php?m={$controller}&a=insertExcel" method="post" enctype="multipart/form-data">
        <table width=100%>
            <tr>
                <td>
                    导入excel表格：
                    <select name="grade_id">
                        <volist name="grade_list" id="val">
                            <option value="{$val.id}">{$val.name}</option>
                        </volist>
                    </select>
                    <select name="cate_id">
                        <volist name="cate_list" id="val">
                            <option value="{$val.id}">{$val.name}</option>
                        </volist>
                    </select>
                    <input type="file" name="file">
                    <input type="hidden" name="create_id" value="{$_SESSION['admin_info']['id']}"/>
                    <input type="hidden" name="school_id" value="{$_SESSION['admin_info']['school_id']}"/>
                    <input type="hidden" name="question_tab" value="{$question_tab}"/>
                    <input type="submit" class="button" value="导入XLS">
                    <!--<input type="button" class="button" id="exportCSV" value="导出XLS" onClick="window.location.href='do.php?action=export'">-->
                </td>
            </tr>
        </table>
    </form>
</div>
<hr style="color:blue;"/>
<div style="margin-left: 10px;margin_bottom:10px;">
    <span style="font-size:14px;color:blue;font-weight: bold;line-height:30px;">单个题目上传：</span>
    <span style="color:red;">&nbsp;&nbsp;注：上传的文档和截图一旦提交成功，将无法修改，请谨慎操作（如有特殊需要，请删除本题后重新上传新题）！</span>
</div>
<form action="admin.php?m={$controller}&a=upsave" method="post" name="myform" id="myform" onsubmit="return check()" enctype="multipart/form-data">
    <input type="hidden" name="display" id="display" value="{$display}" />
    <input type="hidden" name="id" id="id" value="{$id}" />
    <table width="100%" cellpadding="2" cellspacing="1" class="table_form">
        <tr>
            <th width="80">年级 :</th>
            <td>
                <select name="grade_id" id="grade_id">
                    <volist name="grade_list" id="val">
                        <option value="{$val.id}" <if condition="$question_info['grade_id'] eq $val['id']">selected="selected"</if>>{$val.name}</option>
                    </volist>
                </select>
            </td>
        </tr>
        <tr>
            <th width="80">学科 :</th>
            <td>
                <select name="cate_id" id="cate_id">
                    <volist name="cate_list" id="val">
                        <option value="{$val.id}" <if condition="$question_info['cate_id'] eq $val['id']">selected="selected"</if>>{$val.name}</option>
                    </volist>
                </select>
            </td>
        </tr>
        <tr>
            <th>期数 :</th>
            <td><input type="text" name="site_logo" id="site_logo" class="input-text" value="{$question_info.site_logo}" /></td>
        </tr>
        <tr>
            <th>题目序号 :</th>
            <td><input type="text" name="net_logo" id="net_logo" class="input-text" value="{$question_info.net_logo}" /></td>
        </tr>
        <tr>
            <th>解析格式 :</th>
            <td><input type="text" name="recommend" id="recommend" class="input-text" value="{$question_info.recommend}" /></td>
        </tr>
        <tr>
            <th>知识点编号 :</th>
            <td>
                <input type="text" name="title_attribute" id="title_attribute" class="input-text" value="{$question_info.title_attribute}" style="width:700px;"/>
            </td>
        </tr>
        <tr>
            <th>题目简介 :</th>
            <td>
                <textarea name="name" id="name" style="width:700px;height:100px;">
                    {$question_info.name}
                </textarea>
            </td>
        </tr>
        <!--<tr>
            <th>题干 :</th>
            <td>
                <textarea name="title" id="title" style="width:700px;height:100px;">
                    {$title}
                </textarea>
            </td>
        </tr>-->
        <!--<tr>
            <th>解析文本 :</th>
            <td>
                <textarea name="info" id="info" style="width:700px;height:100px;">
                    {$info}
                </textarea>
            </td>
        </tr>-->
        <!--<tr>
            <th>解析视频 :</th>
            <td>
                <empty name="question_info.click_url">
                    <input type="file" name="file" value=""/>
                <else />
                    <embed src="{$question_info.click_url}" allowscriptaccess='always'
                           allowfullscreen='true' wmode='opaque' width='480' height='400'>
                    </embed>
                </empty>
            </td>
        </tr>-->
        <tr>
            <th>答案 :</th>
            <td>
                <textarea name="answer" id="answer" style="width:700px;height:100px;">
                    {$question_info.answer}
                </textarea>
            </td>
        </tr>
        <empty name="png_url">
            <tr>
                <th>检测上传环境：</th>
                <td>
                    <input  type="button" id="upword" value="一键检测"/>
                    <input type="hidden" id="dir" value="0"/>
                </td>
            </tr>
            <tr>
                <th>word文档 :</th>
                <td>
                    <input  type="file" name="word" value=""/>
                </td>
            </tr>
            <tr>
                <th>png或jpg截图 :</th>
                <td>
                    <input  type="file" name="png" value=""/>
                </td>
            </tr>
            <tr>
                <th>pdf预览文档 :</th>
                <td>
                    <input  type="file" name="pdf" value=""/>
                </td>
            </tr>
        <else />
            <tr>
                <th>题目 :</th>
                <td>
                    <img src="{$png_url}"/>
                </td>
            </tr>
        </empty>
        <tr>
            <th>选项数量 :</th>
            <td><input type="text" name="installment" id="installment" class="input-text" value="{$question_info.installment}" /></td>
        </tr>
        <tr>
            <th>大题难易度 :</th>
            <td><input type="text" name="has_invoice" id="has_invoice" class="input-text" value="{$question_info.has_invoice}" /></td>
        </tr>
        <tr>
            <th>小题难易度 :</th>
            <td><input type="text" name="cash_back_rate" id="cash_back_rate" class="input-text" value="{$question_info.cash_back_rate}" /></td>
        </tr>
        <tr>
            <th>题目属性 :</th>
            <td><input type="text" name="subject" id="subject" class="input-text" value="{$question_info.subject}" /></td>
        </tr>
        <tr>
            <th>状态 :</th>
            <td>
                <input type="radio" name="status" class="radio_style" value="1" <if condition="$question_info.status eq 1">checked="checked"</if>

                > &nbsp;有效&nbsp;&nbsp;&nbsp;
                <input type="radio" name="status" class="radio_style" value="0" <if condition="$question_info.status eq 0">checked="checked"</if>> &nbsp;禁用
            </td>
        </tr>
        <tr>
            <th></th>
            <td>
                <input type="submit" value="确定" style="width:50px;height: 30px;background-color: #5189C4;color: white;margin-left:290px;"/>
                <if condition="$id gt 0">
                    <input type="button" value="返回" onclick="window.history.go(-1)" style="width:50px;height: 30px;background-color: #5189C4;color: white;margin-left:20px;"/>
                <else/>
                    <input type="reset" value="重置" style="width:50px;height: 30px;background-color: #5189C4;color: white;margin-left:20px;"/>
                </if>
            </td>
        </tr>
    </table>
</form>
<script type="text/javascript">
var editorName;
//var editorTitle;
//var editorInfo;
var editorAnswer;
KindEditor.ready(function(K) {
    editorName = K.create('#name');
    editorName.sync();
});
//KindEditor.ready(function(K) {
//    editorTitle = K.create('#title');
//    editorTitle.sync();
//});
//KindEditor.ready(function(K) {
//    editorInfo = K.create('#info');
//    editorInfo.sync();
//});
KindEditor.ready(function(K) {
    editorAnswer = K.create('#answer');
    editorAnswer.sync();
});
$(function(){
    $.formValidator.initConfig({
        formid:"myform",
        autotip:true,
        onerror:function(msg,obj){
            window.top.art.dialog({
                        content:msg,
                        lock:true,
                        width:'200',
                        height:'50'},
                    function()
                    {
                        this.close();
                        $(obj).focus();
                    })
        }});

    $("#site_logo").formValidator({
        onshow:"请填写期数",onfocus:"请填写期数"
    }).inputValidator({
        min:1,onerror:"期数不能少于1个字"
    });
    $("#net_logo").formValidator({
        onshow:"请填写题目序号",onfocus:"请填写题目序号"
    }).inputValidator({
        min:1,onerror:"题目序号不能少于1个字"
    });
    $("#recommend").formValidator({
        onshow:"请填写解析格式",onfocus:"请填写解析格式"
    }).inputValidator({
        min:1,onerror:"解析格式不能少于1个字"
    });

});
function check(){
    if(editorName.html()==''){
        alert('请填写题目简介！');
        return false;
    }
//    if(editorTitle.html()==''){
//        alert('请填写题干！');
//        return false;
//    }
    if(editorAnswer.html()==''){
        alert('请填写题目答案！');
        return false;
    }
    if($('#dir').val()=='0'){
        alert('请先检测上传环境！');
        return false;
    }
    return true;
}
//由于服务器上传时，响应有延迟(创建文件夹和移动临时文件不能连续操作)，
// 所以需要先准备好题目文档存放目录，故增加此功能
$('#upword').click(function(){
    var grade = $('#grade_id').val();
    var cate = $('#cate_id').val();
    var site = $('#site_logo').val();
    var net = $('net_logo').val();
    if(site==''){
        alert('请先填写期数后再检测！');
        return false;
    }
    if(net==''){
        alert('请先填写题目序号后再检测！');
        return false;
    }
    var url = "admin.php?m={$controller}&a=upword";
    $.get(url, {grade:grade,cate:cate,site:site,net:net}, function(jsondata){
        if(jsondata.status){
            $('#dir').val('1');
            window.top.art.dialog({id:'upword',content:jsondata.info,lock:true,width:'200',height:'50',time:1});
        }else{
            window.top.art.dialog({id:'upword',content:jsondata.info,lock:true,width:'380',height:'50',time:1});
        }
    });
});
</script>
</div>
</body>
</html>