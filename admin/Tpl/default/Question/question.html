<include file="Public:header" />
<style type="text/css"> table {font-size: 12px} </style>
<div class="pad-lr-10">
    <form name="searchform" id="searchform" action="admin.php?m={$controller}&a={$display}" method="get" >
        <table width="100%" cellspacing="0" class="search-form">
            <tbody>
            <tr>
                <td>
                    <div class="explain-col">
                        <span>年级 :</span>
                        <select name="grade_id" id="grade_id" onchange="showPoint()">
                            <option value="">请选择</option>
                            <volist name="grade_list" id="val">
                                <option value="{$val.id}" <if condition="$grade_id eq $val['id']">selected="selected"</if>>{$val.name}</option>
                            </volist>
                        </select>
                        <span style="margin-left:30px;">学科 :</span>
                        <select name="cate_id" id="cate_id" onchange="showPoint()">
                            <option value="">请选择</option>
                            <volist name="cate_list" id="val">
                                <option value="{$val.id}" <if condition="$cate_id eq $val['id']">selected="selected"</if>>{$val.name}</option>
                            </volist>
                        </select>
                        <input type="hidden" name="m" value="{$controller}" />
                        <input type="hidden" name="a" value="{$display}" />
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="one_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="two_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="three_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="four_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="five_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="six_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="explain-col">
                        <span id="submit">
                            <span style="margin-left:60px;"></span>
                            <input type="submit" name="search" class="button" value="搜索" />
                            <span style="margin-left:35px;"></span>
                            <input type="button" class="button" value="重置" onclick="clean()"/>
                        </span>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
    <form id="myform" name="myform" action="admin.php?m={$controller}&a=deleteQuestion" method="post" onsubmit="return checkQuestion();">
        <div class="table-list">
            <table width="100%" cellspacing="0">
                <thead>
                <tr>
                    <th width=5%>ID</th>
                    <th width=5%><input type="checkbox" value="" id="check_box" onclick="selectall('id[]');"></th>
                    <th>题目</th>
                    <th width=8%>答案</th>
                    <!--<th width=7%>大题难易度</th>-->
                    <th width=6%>是否收藏</th>
                    <th width=6%>是否下载</th>
                    <th width=12%>操作</th>
                </tr>
                </thead>
                <tbody>
                <volist name="question_list" id="val" key="k" >
                    <tr>
                        <td align="center">{$val.id}</td>
                        <td align="center"><input type="checkbox" value="{$val.id}" name="id[]"></td>
                        <td align="left">
                            <a href="javascript:lookQuestion({$val.id})"><img src="{$val.src}"/></a>
                        </td>
                        <td align="center">{$val.answer}</td>
                        <!--<td align="center">{$val.has_invoice}</td>-->
                        <td align="center">
                            <if condition="$val['is_collect'] eq 1">
                                <span style="color:#009933;">已收藏</span>
                                <else/>
                                未收藏
                            </if>
                        </td>
                        <td align="center" id="download_{$val.id}">
                            <if condition="$val['is_download'] eq 1">
                                <span style="color:#009933;">已下载</span>
                                <else/>
                                未下载
                            </if>
                        </td>
                        <td align="center">
                            <a href="javascript:collectQuestion({$val.id})" style="color:#0000FF;width:20px;">收藏</a>&nbsp;
                            <a href="javascript:lookQuestion({$val.id})" style="color:#0000FF;width:20px;">预览</a>&nbsp;
                            <if condition="$edit_access">
                                <a href="javascript:editQuestion({$val.id})" style="color:#0000FF;width:20px;">编辑</a>&nbsp;
                            </if>
                            <a href="javascript:downloadQuestion({$val.id})" style="color:#0000FF;width:20px;">下载</a>
                        </td>
                    </tr>
                </volist>
                </tbody>
            </table>
            <div class="btn">
                <label for="check_box" style="float:left;">{$Think.lang.select_all}/{$Think.lang.cancel}</label>
                <if condition="$delete_access">
                    <input type="submit" class="button" name="dosubmit" value="{$Think.lang.delete}" onclick="return confirm('{$Think.lang.sure_delete}')" style="float:left;margin-left:10px;"/>
                </if>
                <input type="button" class="button" value="{$Think.lang.download}" onclick="dl(this);" style="float:left;margin-left:10px;"/>
                <div id="pages">{$page}</div>
            </div>
        </div>
    </form>
</div>
<script language="javascript">
    //所有知识点信息的存放数组
    var point = new Array(
            {$point}['one_list'],{$point}['two_list'],
            {$point}['three_list'],{$point}['four_list'],
            {$point}['five_list'],{$point}['six_list']
    );
    //与阿拉伯数字相对应的简体汉字
    var large = new Array();
    large[1] = '一';
    large[2] = '二';
    large[3] = '三';
    large[4] = '四';
    large[5] = '五';
    large[6] = '六';
    //选中的知识点编号值
    var point_id = new Array();
    point_id[1] = "{$one_id}";
    point_id[2] = "{$two_id}";
    point_id[3] = "{$three_id}";
    point_id[4] = "{$four_id}";
    point_id[5] = "{$five_id}";
    point_id[6] = "{$six_id}";
    //各级知识点的input名
    var point_name = new Array();
    point_name[1] = 'one_id';
    point_name[2] = 'two_id';
    point_name[3] = 'three_id';
    point_name[4] = 'four_id';
    point_name[5] = 'five_id';
    point_name[6] = 'six_id';
    //各级知识点div的id值
    var list_name = new Array();
    list_name[1] = "one_list";
    list_name[2] = "two_list";
    list_name[3] = "three_list";
    list_name[4] = "four_list";
    list_name[5] = "five_list";
    list_name[6] = "six_list";
$(function(){
    //从其他页面（如上传新题页面）跳转到此页面后，需要调用一下父窗口的_MP方法，才能保证样式和targetUrl是当前页面
    var controller = "{$controller}";
    var display = "{$display}";
    var menuid = 0;
    if(controller=='Ad'){
        menuid = 152;
    }else if(controller=='SellerList'){
        if(display=='yun'){
            menuid = 141;
        }else if(display=='school'){
            menuid = 142;
        }

    }else if(controller=='Article'){
        menuid = 103;
    }
    var src = $("#rightMain",parent.document).attr('src');
    var targetUrl = "/admin.php?m="+controller+"&a="+display;
    if(src!=targetUrl){
        parent._MP(menuid,targetUrl);
    }
    showPoint();
});
//知识点逐级显示
function showPoint(){
    var grade_id = $("#grade_id").val();
    var cate_id = $("#cate_id").val();
    var k = grade_id+cate_id;
    if(k==''){
        k = "{$grade_id}"+"{$cate_id}";
    }
    if(k!=''){
        changePoint(1,k);

    }else{
        removePoint(1);
    }
    checkPoint();
    //六级联动
    var k1 = '';
    $("input[name='one_id']").change(function(){
        k1 = $(this).val();
        changePoint(2,k1);
        $("input[name='two_id']").change(function(){
            var i = $(this).val();
            changePoint(3,i);
            $("input[name='three_id']").change(function(){
                var i = $(this).val();
                changePoint(4,i);
                $("input[name='four_id']").change(function(){
                    var i = $(this).val();
                    changePoint(5,i);
                    $("input[name='five_id']").change(function(){
                        var i = $(this).val();
                        changePoint(6,i);
                    });
                });
            });
        });
    });
    //五级联动
    $("input[name='two_id']").change(function(){
        var i = $(this).val();
        changePoint(3,i);
        $("input[name='three_id']").change(function(){
            var i = $(this).val();
            changePoint(4,i);
            $("input[name='four_id']").change(function(){
                var i = $(this).val();
                changePoint(5,i);
                $("input[name='five_id']").change(function(){
                    var i = $(this).val();
                    changePoint(6,i);
                });
            });
        });
    });
    //四级联动
    $("input[name='three_id']").change(function(){
        var i = $(this).val();
        changePoint(4,i);
        $("input[name='four_id']").change(function(){
            var i = $(this).val();
            changePoint(5,i);
            $("input[name='five_id']").change(function(){
                var i = $(this).val();
                changePoint(6,i);
            });
        });
    });
    //三级联动
    $("input[name='four_id']").change(function(){
        var i = $(this).val();
        changePoint(5,i);
        $("input[name='five_id']").change(function(){
            var i = $(this).val();
            changePoint(6,i);
        });
    });
    //两级联动
    $("input[name='five_id']").change(function(){
        var i = $(this).val();
        changePoint(6,i);
    });

}
//显示用户选择的数据
function checkPoint(){
    for(var i=1;i<6;i++){
        var k = point_id[i];
        if(k!=''){
            changePoint(i+1,k);
        }
    }
}
//取消用户选择的数据
function forgetPoint(tag){
    for(var i=tag;i<7;i++){
        $("input[name="+point_name[i]+"]").val('');
    }
}
//显示指定级别的知识点目录
function changePoint(tag,k){
    removePoint(tag+1);
    if(point[tag-1][k]!=undefined){
        var list = large[tag]+'级目录：';
        $.each(point[tag-1][k],function(id,obj){
            var check = '';
            if(obj.alias==point_id[tag]){
                check = 'checked';
            }
            var idn = obj.alias;
            list += "<input type='radio' name="+point_name[tag]+" id="+idn+" value='"+obj.alias+"'"+check+"/>";
            list += "<label for="+idn+">"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
        });
        var ln = '#'+list_name[tag];
        $(ln).removeClass('explain-col');
        $(ln).html(list);
        $(ln).addClass('explain-col');
    }else{
        removePoint(tag);
    }
}
//移除指定级别的知识点目录
function removePoint(tag){
    for(var i=tag;i<7;i++){
        $('#'+list_name[i]).removeClass('explain-col');
        $('#'+list_name[i]).html('');
    }
}
//重置
function clean(){
    $("#grade_id").val('');
    $("#cate_id").val('');
    forgetPoint(1);
    $("#searchform").submit();
}

function checkQuestion(){
    var ids='';
    $("input[name='id[]']:checked").each(function(i, n){
        ids += $(n).val() + ',';
    });
    if(ids=='') {
        window.top.art.dialog({content:lang_please_select+'菜单分类名称	',lock:true,width:'200',height:'50',time:1.5},function(){});
        return false;
    }
    return true;
}
//更改状态
function statusQuestion(id,type){
    var url = "admin.php?m={$controller}&a=statusQuestion";
    $.get(url, { id: id, type: type }, function(jsondata){
        var return_data  = eval("("+jsondata+")");
        $("#"+type+"_"+id+" img").attr('src', '__ROOT__/statics/images/status_'+return_data+'.gif');
    });
}
//排序方法
function sortQuestion(id,type,num){
    var url = "admin.php?m={$controller}&a=sortQuestion";
    $.get(url, { id: id, type: type,num:num }, function(jsondata){
        var return_data  = eval("("+jsondata+")");
        $("#"+type+"_"+id+" ").attr('value', return_data);
    });
}
//预览
function lookQuestion(id) {
    window.top.art.dialog({id:'lookQuestion'}).close();
    window.top.art.dialog({
                title:"题目预览",
                id:'lookQuestion',
                iframe:"?m={$controller}&a=lookQuestion&id="+id,width:'700',height:'500'
            },
            function()
            {
                window.top.art.dialog({id:'lookQuestion'}).close()
            });
}
//编辑
function editQuestion(id) {
    location.href = "admin.php?m={$controller}&a=editQuestion&display={$display}"+"&id="+id;
}
//收藏
function collectQuestion(id) {
    var url = "admin.php?m={$controller}&a=collectQuestion";
    $.get(url, { id: id }, function(jsondata){
        window.top.art.dialog({id:'collectQuestion',content:jsondata.info,lock:true,width:'200',height:'50',time:1});
        if(jsondata.status==1){
            window.location.reload();
        }
    });
}
//下载
function downloadQuestion(id) {
    var url = "admin.php?m={$controller}&a=downloadQuestion";
    $.get(url, { id: id }, function(jsondata){
        if(jsondata.status==2){
            if(confirm(jsondata.info)){
                location.href = "download.php?id="+id+"&pid={$period_id}&tab={$question_tab}";
            }
        }else{
                $('#download_'+id).html("<span style='color:#009933;'>已下载</span>");
            location.href = "download.php?id="+id+"&pid={$period_id}&tab={$question_tab}";
        }
    });
}
//批量下载
function dl(){
    var ids='';
    $("input[name='id[]']:checked").each(function(i, n){
        var id = $(n).val();
        $('#download_'+id).html("<span style='color:#009933;'>已下载</span>");
        ids += id + ',';
    });
    if(ids=='') {
        window.top.art.dialog({content:lang_please_select+'菜单分类名称	',lock:true,width:'200',height:'50',time:1.5},function(){});
        return false;
    }else{
        location.href = "dl.php?ids="+ids+"&pid={$period_id}&admin_id={$admin_id}";
    }

}
</script>
</body>
</html>