<include file="Public:header" />
<style type="text/css"> table {font-size: 12px} </style>
<div class="pad-lr-10">
    <form name="searchform" id="searchform" action="admin.php?m={$controller}&a={$display}" method="get" >
        <table width="100%" cellspacing="0" class="search-form">
            <tbody>
            <tr>
                <td>
                    <div class="explain-col">
                        <span>年级 :</span>
                        <select name="grade_id" id="grade_id" onchange="getPointList()">
                            <option value="">请选择</option>
                            <volist name="grade_list" id="val">
                                <option value="{$val.id}" <if condition="$grade_id eq $val['id']">selected="selected"</if>>{$val.name}</option>
                            </volist>
                        </select>
                        <span style="margin-left:30px;">学科 :</span>
                        <select name="cate_id" id="cate_id" onchange="getPointList()">
                            <option value="">请选择</option>
                            <volist name="cate_list" id="val">
                                <option value="{$val.id}" <if condition="$cate_id eq $val['id']">selected="selected"</if>>{$val.name}</option>
                            </volist>
                        </select>
                        <input type="hidden" name="m" value="{$controller}" />
                        <input type="hidden" name="a" value="{$display}" />
                        <span id="submit">
                            <span style="margin-left:20px;"></span>
                            <input type="submit" name="search" class="button" value="搜索" />&nbsp;
                            <input type="button" class="button" value="重置" onclick="clean()"/>
                        </span>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="point_list"></div>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
    <form id="myform" name="myform" action="admin.php?m={$controller}&a=deleteQuestion" method="post" onsubmit="return checkQuestion();">
        <div class="table-list">
            <table width="100%" cellspacing="0">
                <thead>
                <tr>
                    <th width=50>ID</th>
                    <th>题目简介</th>
                    <th width=100>答案</th>
                    <th width=80>大题难易度</th>
                    <th width=80>是否收藏</th>
                    <th width=80>是否下载</th>
                    <th width=120>操作</th>
                </tr>
                </thead>
                <tbody>
                <volist name="question_list" id="val" key="k" >
                    <tr>
                        <td align="center">{$val.id}</td>
                        <td align="center">{$val.name}</td>
                        <td align="center">{$val.answer}</td>
                        <td align="center">{$val.has_invoice}</td>
                        <td align="center">
                            <if condition="$val['is_collect'] eq 1">
                                <span style="color:#009933;">已收藏</span>
                                <else/>
                                未收藏
                            </if>
                        </td>
                        <td align="center">
                            <if condition="$val['is_download'] eq 1">
                                <span style="color:#009933;">已下载</span>
                                <else/>
                                未下载
                            </if>
                        </td>
                        <td align="center">
                            <a href="javascript:editQuestion({$val.id})" style="color:#0000FF;width:20px;">查看</a>&nbsp;
                            <a href="javascript:collectQuestion({$val.id})" style="color:#0000FF;width:20px;">收藏</a>&nbsp;
                            <a href="javascript:downloadQuestion({$val.id})" style="color:#0000FF;width:20px;">下载</a>
                        </td>
                    </tr>
                </volist>
                </tbody>
            </table>
            <div class="btn">
                <!--<label for="check_box" style="float:left;">{$Think.lang.select_all}/{$Think.lang.cancel}</label>
                <input type="submit" class="button" name="dosubmit" value="{$Think.lang.delete}" onclick="return confirm('{$Think.lang.sure_delete}')" style="float:left;margin-left:10px;"/>-->
                <div id="pages">{$page}</div>
            </div>
        </div>
    </form>
</div>
<script language="javascript">
    $(function(){
        //从其他页面（如上传新题页面）跳转到此页面后，需要调用一下父窗口的_MP方法，才能保证样式和targetUrl是当前页面
        var controller = "{$controller}";
        var display = "{$display}";
        var menuid = 0;
        if(controller=='Ad'){
            menuid = 152;
        }else if(controller=='SellerList'){
            menuid = 141;
        }else if(controller=='Article'){
            menuid = 103;
        }
        var src = $("#rightMain",parent.document).attr('src');
        var targetUrl = '/admin.php?m='+controller+'&a='+display;
        if(src!=targetUrl){
            parent._MP(menuid,targetUrl);
        }
        getPointList();
    });
    //重置
    function clean(){
        $("#grade_id").val('');
        $("#cate_id").val('');
        $("#searchform").submit();
    }
    //判断年级和学科有没有选择
    function isChecked(){
        var grade_id = $("#grade_id").val();
        var cate_id = $("#cate_id").val();
        if(grade_id == ""){
            alert("请先选择年级！");
            return false;
        }
        if(cate_id == ""){
            alert("请先选择学科！");
            return false;
        }
    }
    //知识点复选框样式初始化
    function pointStyle(){
        $("#point_list").removeClass('explain-col');
        var submit = "<span style='margin-left:20px;'></span>" +
        "<input type='submit' name='search' class='button' value='搜索' />&nbsp; " +
        "<input type='button' class='button' value='重置' onclick='clean()'/>";
        var point_list = $("#point_list").html();
        if(point_list!=''){
            $("#submit").html('');
            $("#point_list").html('');
            //搜索和重置按钮调整位置，放所有搜索条件的后面
            point_list = '知识点：&nbsp;'+point_list;
            point_list += "<span id='search'>"+submit+"</span>";
            $("#point_list").html(point_list);
            //添加样式
            $("#point_list").addClass('explain-col');
        }
    }
    //获取知识点列表
    function getPointList(){
        var grade_id = $("#grade_id").val();
        var cate_id = $("#cate_id").val();
        if(grade_id!='' && cate_id!=''){
            var url = "admin.php?m={$controller}&a=getPointList";
            $.get(url, { grade_id: grade_id, cate_id: cate_id }, function(jsondata){
                //搜索和重置按钮复原
                var submit = $("#submit").html();
                if(submit==''){
                    submit = "<span style='margin-left:20px;'></span>" +
                    "<input type='submit' name='search' class='button' value='搜索' />&nbsp; " +
                    "<input type='button' class='button' value='重置' onclick='clean()'/>";
                    $("#submit").html(submit);
                }
                //知识点条件搜索栏置空
                $("#point_list").html('');
                $("#point_list").removeClass('explain-col');
                //若选中的年级和学科下有知识点，则显示
                if(jsondata!=''){
                    var submit = $("#submit").html();
                    $("#submit").html('');
                    $("#point_list").html('');
                    $("#point_list").addClass('explain-col');
                    var point_list = "知识点：&nbsp;";
                    $.each(jsondata,function(idx,obj){
                        point_list += "<input type='checkbox' name='point_id[]' id='point_"+obj.id+"' value='"+obj.alias+"' "+{$checked}[obj.alias]+"/>";
                        point_list += "<label for='point_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
                    });
                    //搜索和重置按钮调整位置，放所有搜索条件的后面
                    point_list += "<span id='search'>"+submit+"</span>";
                    $("#point_list").html(point_list);
                }
            });
        }
    }

    function checkQuestion(){
        var ids='';
        $("input[name='id[]']:checked").each(function(i, n){
            ids += $(n).val() + ',';
        });
        if(ids=='') {
            window.top.art.dialog({content:lang_please_select+'菜单分类名称	',lock:true,width:'200',height:'50',time:1.5},function(){});
            return false;
        }
        return true;
    }

    function statusQuestion(id,type){
        var url = "admin.php?m={$controller}&a=statusQuestion";
        $.get(url, { id: id, type: type }, function(jsondata){
            var return_data  = eval("("+jsondata+")");
            $("#"+type+"_"+id+" img").attr('src', '__ROOT__/statics/images/status_'+return_data+'.gif');
        });
    }
    //排序方法
    function sortQuestion(id,type,num){
        var url = "admin.php?m={$controller}&a=sortQuestion";
        $.get(url, { id: id, type: type,num:num }, function(jsondata){
            var return_data  = eval("("+jsondata+")");
            $("#"+type+"_"+id+" ").attr('value', return_data);
        });
    }
    //查看、编辑
    function editQuestion(id) {
        location.href = "admin.php?m={$controller}&a=editQuestion&id="+id;
    }
    //收藏
    function collectQuestion(id) {
        var url = "admin.php?m={$controller}&a=collectQuestion";
        $.get(url, { id: id }, function(jsondata){
            window.top.art.dialog({id:'collectQuestion',content:jsondata.info,lock:true,width:'200',height:'50',time:1});
            if(jsondata.status==1){
                window.location.reload();
            }
        });
    }
    //下载
    function downloadQuestion(id) {
        var url = "admin.php?m={$controller}&a=downloadQuestion";
        $.get(url, { id: id }, function(jsondata){
            if(jsondata.status==2){
                //已下载过，是否要重新下载
                window.top.art.dialog({id:'downloadAsk'}).close();
                window.top.art.dialog(
                        {
                            title:'提示',
                            id:'downloadAsk',
                            iframe:'?m={$controller}&a=downloadAsk&id='+id,
                            width:'360',
                            height:'50'
                        },
                        function(){
                            var d = window.top.art.dialog({id:'downloadAsk'}).data.iframe;
                            d.document.getElementById('dosubmit').click();
                            return false;
                        },
                        function(){
                            window.top.art.dialog({id:'downloadAsk'}).close()
                        }
                );
//                if(confirm(jsondata.info)){
//                    $.get("admin.php?m={$controller}&a=downloadDirect", { id: id }, function(data){
//                        alert(data.info);
//                    });
//                }
            }else{
                window.top.art.dialog({content:jsondata.info,lock:true,width:'200',height:'50',time:1});
                if(jsondata.status==1){
                    window.location.reload();
                }
            }
        });
    }
</script>
</body>
</html>