<include file="Public:header" />
<style type="text/css"> table {font-size: 12px} </style>
<div class="pad-lr-10">
    <form name="searchform" id="searchform" action="admin.php?m={$controller}&a={$display}" method="get" >
        <table width="100%" cellspacing="0" class="search-form">
            <tbody>
            <tr>
                <td>
                    <div class="explain-col">
                        <span>年级 :</span>
                        <select name="grade_id" id="grade_id" onchange="showPoint()">
                            <option value="">请选择</option>
                            <volist name="grade_list" id="val">
                                <option value="{$val.id}" <if condition="$grade_id eq $val['id']">selected="selected"</if>>{$val.name}</option>
                            </volist>
                        </select>
                        <span style="margin-left:30px;">学科 :</span>
                        <select name="cate_id" id="cate_id" onchange="showPoint()">
                            <option value="">请选择</option>
                            <volist name="cate_list" id="val">
                                <option value="{$val.id}" <if condition="$cate_id eq $val['id']">selected="selected"</if>>{$val.name}</option>
                            </volist>
                        </select>
                        <input type="hidden" name="m" value="{$controller}" />
                        <input type="hidden" name="a" value="{$display}" />
                        <span id="submit">
                            <span style="margin-left:20px;"></span>
                            <input type="submit" name="search" class="button" value="搜索" />&nbsp;
                            <input type="button" class="button" value="重置" onclick="clean()"/>
                        </span>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="one_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="two_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="three_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="four_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="five_list"></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="six_list"></div>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
    <form id="myform" name="myform" action="admin.php?m={$controller}&a=deleteQuestion" method="post" onsubmit="return checkQuestion();">
        <div class="table-list">
            <table width="100%" cellspacing="0">
                <thead>
                <tr>
                    <th width=3%>ID</th>
                    <th width=2%><input type="checkbox" value="" id="check_box" onclick="selectall('id[]');"></th>
                    <th>题目</th>
                    <th width=8%>答案</th>
                    <!--<th width=7%>大题难易度</th>-->
                    <th width=6%>是否收藏</th>
                    <th width=6%>是否下载</th>
                    <th width=12%>操作</th>
                </tr>
                </thead>
                <tbody>
                <volist name="question_list" id="val" key="k" >
                    <tr>
                        <td align="center">{$val.id}</td>
                        <td align="center"><input type="checkbox" value="{$val.id}" name="id[]"></td>
                        <td align="center">
                            <img src="{$val.src}"/>
                        </td>
                        <td align="center">{$val.answer}</td>
                        <!--<td align="center">{$val.has_invoice}</td>-->
                        <td align="center">
                            <if condition="$val['is_collect'] eq 1">
                                <span style="color:#009933;">已收藏</span>
                                <else/>
                                未收藏
                            </if>
                        </td>
                        <td align="center" id="download_{$val.id}">
                            <if condition="$val['is_download'] eq 1">
                                <span style="color:#009933;">已下载</span>
                                <else/>
                                未下载
                            </if>
                        </td>
                        <td align="center">
                            <a href="javascript:collectQuestion({$val.id})" style="color:#0000FF;width:20px;">收藏</a>&nbsp;
                            <a href="javascript:lookQuestion({$val.id})" style="color:#0000FF;width:20px;">预览</a>&nbsp;
                            <a href="javascript:editQuestion({$val.id})" style="color:#0000FF;width:20px;">编辑</a>&nbsp;
                            <a href="javascript:downloadQuestion({$val.id})" style="color:#0000FF;width:20px;">下载</a>
                        </td>
                    </tr>
                </volist>
                </tbody>
            </table>
            <div class="btn">
                <label for="check_box" style="float:left;">{$Think.lang.select_all}/{$Think.lang.cancel}</label>
                <input type="submit" class="button" name="dosubmit" value="{$Think.lang.delete}" onclick="return confirm('{$Think.lang.sure_delete}')" style="float:left;margin-left:10px;"/>
                <input type="button" class="button" value="{$Think.lang.download}" onclick="dl(this);" style="float:left;margin-left:10px;"/>
                <div id="pages">{$page}</div>
            </div>
        </div>
    </form>
</div>
<script language="javascript">
$(function(){
    //从其他页面（如上传新题页面）跳转到此页面后，需要调用一下父窗口的_MP方法，才能保证样式和targetUrl是当前页面
    var controller = "{$controller}";
    var display = "{$display}";
    var menuid = 0;
    if(controller=='Ad'){
        menuid = 152;
    }else if(controller=='SellerList'){
        if(display=='yun'){
            menuid = 141;
        }else if(display=='school'){
            menuid = 142;
        }

    }else if(controller=='Article'){
        menuid = 103;
    }
    var src = $("#rightMain",parent.document).attr('src');
    var targetUrl = "/admin.php?m="+controller+"&a="+display;
    if(src!=targetUrl){
        parent._MP(menuid,targetUrl);
    }
    showPoint();
//    getOneList();
});
function showPoint(){
    var one_point = {$point}['one_list'];
    var two_point = {$point}['two_list'];
    var three_point = {$point}['three_list'];
    var four_point = {$point}['four_list'];
    var five_point = {$point}['five_list'];
    var six_point = {$point}['six_list'];
    var grade_id = $("#grade_id").val();
    var cate_id = $("#cate_id").val();
    if(grade_id!='' && cate_id!=''){
        var k = grade_id+cate_id;
        if(one_point[k]!=undefined){
            var one_list = '一级目录：';
            $.each(one_point[k],function(id,obj){
                one_list += "<input type='radio' name='one_id' id='one_"+obj.id+"' value='"+obj.alias+"'/>";
                one_list += "<label for='one_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
            });
            $("#one_list").removeClass('explain-col');
            $('#one_list').html(one_list);
            $("#one_list").addClass('explain-col');
        }else{
            $("#one_list").removeClass('explain-col');
            $('#one_list').html('');
            $("#two_list").removeClass('explain-col');
            $('#two_list').html('');
            $("#three_list").removeClass('explain-col');
            $('#three_list').html('');
            $("#four_list").removeClass('explain-col');
            $('#four_list').html('');
            $("#five_list").removeClass('explain-col');
            $('#five_list').html('');
            $("#six_list").removeClass('explain-col');
            $('#six_list').html('');
        }
    }
    $("input[name='one_id']").change(function(){
        var i = $(this).val();
        $("#three_list").removeClass('explain-col');
        $('#three_list').html('');
        $("#four_list").removeClass('explain-col');
        $('#four_list').html('');
        $("#five_list").removeClass('explain-col');
        $('#five_list').html('');
        $("#six_list").removeClass('explain-col');
        $('#six_list').html('');
        if(two_point[i]!=undefined){
            var two_list = '二级目录：';
            $.each(two_point[i],function(id,obj){
                two_list += "<input type='radio' name='two_id' id='two_"+obj.id+"' value='"+obj.alias+"'/>";
                two_list += "<label for='two_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
            });
            $("#two_list").removeClass('explain-col');
            $('#two_list').html(two_list);
            $("#two_list").addClass('explain-col');
            $("input[name='two_id']").change(function(){
                var i = $(this).val();
                $("#four_list").removeClass('explain-col');
                $('#four_list').html('');
                $("#five_list").removeClass('explain-col');
                $('#five_list').html('');
                $("#six_list").removeClass('explain-col');
                $('#six_list').html('');
                if(three_point[i]!=undefined){
                    var three_list = '三级目录：';
                    $.each(three_point[i],function(id,obj){
                        three_list += "<input type='radio' name='three_id' id='three_"+obj.id+"' value='"+obj.alias+"'/>";
                        three_list += "<label for='three_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
                    });
                    $("#three_list").removeClass('explain-col');
                    $('#three_list').html(three_list);
                    $("#three_list").addClass('explain-col');
                    $("input[name='three_id']").change(function(){
                        var i = $(this).val();
                        $("#five_list").removeClass('explain-col');
                        $('#five_list').html('');
                        $("#six_list").removeClass('explain-col');
                        $('#six_list').html('');
                        if(four_point[i]!=undefined){
                            var four_list = '四级目录：';
                            $.each(four_point[i],function(id,obj){
                                four_list += "<input type='radio' name='four_id' id='four_"+obj.id+"' value='"+obj.alias+"'/>";
                                four_list += "<label for='four_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
                            });
                            $("#four_list").removeClass('explain-col');
                            $('#four_list').html(four_list);
                            $("#four_list").addClass('explain-col');
                            $("input[name='four_id']").change(function(){
                                var i = $(this).val();
                                $("#six_list").removeClass('explain-col');
                                $('#six_list').html('');
                                if(five_point[i]!=undefined){
                                    var five_list = '五级目录：';
                                    $.each(five_point[i],function(id,obj){
                                        five_list += "<input type='radio' name='five_id' id='five_"+obj.id+"' value='"+obj.alias+"'/>";
                                        five_list += "<label for='five_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
                                    });
                                    $("#five_list").removeClass('explain-col');
                                    $('#five_list').html(five_list);
                                    $("#five_list").addClass('explain-col');
                                    $("input[name='five_id']").change(function(){
                                        var i = $(this).val();
                                        if(six_point[i]!=undefined){
                                            var six_list = '六级目录：';
                                            $.each(six_point[i],function(id,obj){
                                                six_list += "<input type='radio' name='six_id' id='six_"+obj.id+"' value='"+obj.alias+"'/>";
                                                six_list += "<label for='six_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
                                            });
                                            $("#six_list").removeClass('explain-col');
                                            $('#six_list').html(six_list);
                                            $("#six_list").addClass('explain-col');
                                        }else{
                                            $("#six_list").removeClass('explain-col');
                                            $('#six_list').html('');
                                        }
                                    });
                                }else{
                                    $("#five_list").removeClass('explain-col');
                                    $('#five_list').html('');
                                    $("#six_list").removeClass('explain-col');
                                    $('#six_list').html('');
                                }
                            });
                        }else{
                            $("#four_list").removeClass('explain-col');
                            $('#four_list').html('');
                            $("#five_list").removeClass('explain-col');
                            $('#five_list').html('');
                            $("#six_list").removeClass('explain-col');
                            $('#six_list').html('');
                        }
                    });
                }else{
                    $("#three_list").removeClass('explain-col');
                    $('#three_list').html('');
                    $("#four_list").removeClass('explain-col');
                    $('#four_list').html('');
                    $("#five_list").removeClass('explain-col');
                    $('#five_list').html('');
                    $("#six_list").removeClass('explain-col');
                    $('#six_list').html('');
                }
            });
        }else{
            $("#two_list").removeClass('explain-col');
            $('#two_list').html('');
            $("#three_list").removeClass('explain-col');
            $('#three_list').html('');
            $("#four_list").removeClass('explain-col');
            $('#four_list').html('');
            $("#five_list").removeClass('explain-col');
            $('#five_list').html('');
            $("#six_list").removeClass('explain-col');
            $('#six_list').html('');
        }
    });

}
//重置
function clean(){
    $("#grade_id").val('');
    $("#cate_id").val('');
    $("#searchform").submit();
}
//获取一级目录列表
function getOneList(){
    var grade_id = $("#grade_id").val();
    var cate_id = $("#cate_id").val();
    if(grade_id!='' && cate_id!=''){
        var url = "admin.php?m={$controller}&a=getOneList";
        $.get(url, { grade_id: grade_id, cate_id: cate_id }, function(jsondata){
//            console.log(jsondata.one);
//            return false;
            //搜索和重置按钮复原
            var submit = $("#submit").html();
            if(submit==''){
                submit = "<span style='margin-left:20px;'></span>" +
                "<input type='submit' name='search' class='button' value='搜索' />&nbsp; " +
                "<input type='button' class='button' value='重置' onclick='clean()'/>";
                $("#submit").html(submit);
            }
            //知识点条件搜索栏置空
            $("#one_list").html('');
            $("#one_list").removeClass('explain-col');
            //若选中的年级和学科下有知识点，则显示
            if(jsondata.one!=''){
                var submit = $("#submit").html();
                $("#submit").html('');
                $("#one_list").html('');
                $("#one_list").addClass('explain-col');
                var one_list = "一级目录：&nbsp;";
                $.each(jsondata.one,function(idx,obj){
                    var check = '';
                    var one_id = "{$one_id}";
                    if(one_id==obj.alias){
                        check = 'checked';
                    }
                    one_list += "<input type='radio' name='one_id' id='one_"+obj.id+"' value='"+obj.alias+"' "+check+"/>";
                    one_list += "<label for='one_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
                });
                //搜索和重置按钮调整位置，放所有搜索条件的后面
                one_list += "<span id='search'>"+submit+"</span>";
                $("#one_list").html(one_list);
            }
        });
    }
}

//获取知识点列表
function getPointList(){
    var grade_id = $("#grade_id").val();
    var cate_id = $("#cate_id").val();
    if(grade_id!='' && cate_id!=''){
        var url = "admin.php?m={$controller}&a=getPointList";
        $.get(url, { grade_id: grade_id, cate_id: cate_id }, function(jsondata){
//            console.log(jsondata);
            //搜索和重置按钮复原
            var submit = $("#submit").html();
            if(submit==''){
                submit = "<span style='margin-left:20px;'></span>" +
                "<input type='submit' name='search' class='button' value='搜索' />&nbsp; " +
                "<input type='button' class='button' value='重置' onclick='clean()'/>";
                $("#submit").html(submit);
            }
            //知识点条件搜索栏置空
            $("#point_list").html('');
            $("#point_list").removeClass('explain-col');
            //若选中的年级和学科下有知识点，则显示
            if(jsondata!=''){
                var submit = $("#submit").html();
                $("#submit").html('');
                $("#point_list").html('');
                $("#point_list").addClass('explain-col');
                var point_list = "一级目录：&nbsp;";
                $.each(jsondata,function(idx,obj){
                    point_list += "<input type='checkbox' name='point_id[]' id='point_"+obj.id+"' value='"+obj.alias+"' "+{$checked}[obj.alias]+"/>";
                    point_list += "<label for='point_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
                });
                //搜索和重置按钮调整位置，放所有搜索条件的后面
                point_list += "<span id='search'>"+submit+"</span>";
                $("#point_list").html(point_list);
            }
        });
    }
}

    function checkQuestion(){
        var ids='';
        $("input[name='id[]']:checked").each(function(i, n){
            ids += $(n).val() + ',';
        });
        if(ids=='') {
            window.top.art.dialog({content:lang_please_select+'菜单分类名称	',lock:true,width:'200',height:'50',time:1.5},function(){});
            return false;
        }
        return true;
    }

    function statusQuestion(id,type){
        var url = "admin.php?m={$controller}&a=statusQuestion";
        $.get(url, { id: id, type: type }, function(jsondata){
            var return_data  = eval("("+jsondata+")");
            $("#"+type+"_"+id+" img").attr('src', '__ROOT__/statics/images/status_'+return_data+'.gif');
        });
    }
    //排序方法
    function sortQuestion(id,type,num){
        var url = "admin.php?m={$controller}&a=sortQuestion";
        $.get(url, { id: id, type: type,num:num }, function(jsondata){
            var return_data  = eval("("+jsondata+")");
            $("#"+type+"_"+id+" ").attr('value', return_data);
        });
    }
    //预览
    function lookQuestion(id) {
        window.top.art.dialog({id:'lookQuestion'}).close();
        window.top.art.dialog({
                    title:"题目预览",
                    id:'lookQuestion',
                    iframe:"?m={$controller}&a=lookQuestion&id="+id,width:'700',height:'500'
                },
                function()
                {
                    window.top.art.dialog({id:'lookQuestion'}).close()
                });
    }
    //编辑
    function editQuestion(id) {
        location.href = "admin.php?m={$controller}&a=editQuestion&display={$display}"+"&id="+id;
    }
    //收藏
    function collectQuestion(id) {
        var url = "admin.php?m={$controller}&a=collectQuestion";
        $.get(url, { id: id }, function(jsondata){
            window.top.art.dialog({id:'collectQuestion',content:jsondata.info,lock:true,width:'200',height:'50',time:1});
            if(jsondata.status==1){
                window.location.reload();
            }
        });
    }
    //下载
    function downloadQuestion(id) {
        var url = "admin.php?m={$controller}&a=downloadQuestion";
        $.get(url, { id: id }, function(jsondata){
            if(jsondata.status==2){
                if(confirm(jsondata.info)){
                    location.href = "download.php?id="+id+"&pid={$period_id}&tab={$question_tab}";
                }
            }else{
                    $('#download_'+id).html("<span style='color:#009933;'>已下载</span>");
                location.href = "download.php?id="+id+"&pid={$period_id}&tab={$question_tab}";
            }
        });
    }
    //批量下载
    function dl(){
        var ids='';
        $("input[name='id[]']:checked").each(function(i, n){
            ids += $(n).val() + ',';
        });
        if(ids=='') {
            window.top.art.dialog({content:lang_please_select+'菜单分类名称	',lock:true,width:'200',height:'50',time:1.5},function(){});
            return false;
        }else{
            location.href = "dl.php?ids="+ids+"&pid={$period_id}&tab={$question_tab}";
        }

    }
</script>
</body>
</html>