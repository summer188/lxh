<include file="Public:header" />
<style type="text/css">
    table {font-size: 12px}
    .myqn{width:60px; height:30px; background-color:#5189C4; color:white;}
    .myqnclick{width:60px; height:30px; background-color:#E2E9EA; color:#3A6EA5; font-weight:bold;}
</style>
<div class="pad-lr-10">
    <form name="searchform" id="searchform" action="admin.php?m={$controller}&a=my" method="get" >
        <table width="100%" cellspacing="0" class="search-form">
            <tbody>
            <tr>
                <td>
                    <div class="explain-col">
                        <input type="button" id="myUpload" value="我的上传" class="myqn"/>
                        <input type="hidden" id="upload" name="upload" value="{$upload}"/>
                        <input type="button" id="myDownload" value="我的下载" class="myqn" style="margin-left:10px;"/>
                        <input type="hidden" id="download" name="download" value="{$download}"/>
                        <input type="button" id="myCollect" value="我的收藏" class="myqn" style="margin-left:10px;"/>
                        <input type="hidden" id="collect" name="collect" value="{$collect}"/>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="explain-col">
                        <span>年级 :</span>
                        <select name="grade_id" id="grade_id" onchange="getPointList()">
                            <option value="">请选择</option>
                            <volist name="grade_list" id="val">
                                <option value="{$val.id}" <if condition="$grade_id eq $val['id']">selected="selected"</if>>{$val.name}</option>
                            </volist>
                        </select>
                        <span style="margin-left:30px;">学科 :</span>
                        <select name="cate_id" id="cate_id" onchange="getPointList()">
                            <option value="">请选择</option>
                            <volist name="cate_list" id="val">
                                <option value="{$val.id}" <if condition="$cate_id eq $val['id']">selected="selected"</if>>{$val.name}</option>
                            </volist>
                        </select>
                        <input type="hidden" name="m" value="{$controller}" />
                        <input type="hidden" name="a" value="my" />
                        <span id="submit">
                            <span style="margin-left:20px;"></span>
                            <input type="submit" name="search" class="button" value="搜索" />&nbsp;
                            <input type="button" class="button" value="重置" onclick="clean()"/>
                        </span>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="point_list"></div>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
    <form id="myform" name="myform" action="admin.php?m={$controller}&a=deleteQuestion" method="post" onsubmit="return checkQuestion();">
        <div class="table-list">
            <table width="100%" cellspacing="0">
                <thead>
                <tr>
                    <th width=50>ID</th>
                    <th width=30><input type="checkbox" value="" id="check_box" onclick="selectall('id[]');"></th>
                    <th>题目简介</th>
                    <th width=100>答案</th>
                    <th width=80>大题难易度</th>
                    <th width=80>是否收藏</th>
                    <th width=80>是否下载</th>
                    <th width=120>操作</th>
                </tr>
                </thead>
                <tbody>
                <volist name="question_list" id="val" key="k" >
                    <tr>
                        <td align="center">{$val.id}</td>
                        <td align="center"><input type="checkbox" value="{$val.id}" name="id[]"></td>
                        <td align="center">{$val.name}</td>
                        <td align="center">{$val.answer}</td>
                        <td align="center">{$val.has_invoice}</td>
                        <td align="center">
                            <if condition="$val['is_collect'] eq 1">
                                <span style="color:#009933;">已收藏</span>
                                <else/>
                                未收藏
                            </if>
                        </td>
                        <td align="center" id="download_{$val.id}">
                            <if condition="$val['is_download'] eq 1">
                                <span style="color:#009933;">已下载</span>
                                <else/>
                                未下载
                            </if>
                        </td>
                        <td align="center">
                            <a href="javascript:collectQuestion({$val.id})" style="color:#0000FF;width:20px;">收藏</a>&nbsp;
                            <a href="javascript:lookQuestion({$val.id})" style="color:#0000FF;width:20px;">预览</a>&nbsp;
                            <if condition="$val['create_id'] eq $admin_id">
                                <a href="javascript:editQuestion({$val.id})" style="color:#0000FF;width:20px;">编辑</a>&nbsp;
                            </if>
                            <a href="javascript:downloadQuestion({$val.id})" style="color:#0000FF;width:20px;">下载</a>
                        </td>
                    </tr>
                </volist>
                </tbody>
            </table>
            <div class="btn">
                <label for="check_box" style="float:left;">{$Think.lang.select_all}/{$Think.lang.cancel}</label>
                <input type="submit" class="button" name="dosubmit" value="{$Think.lang.delete}" onclick="return confirm('{$Think.lang.sure_delete}')" style="float:left;margin-left:10px;"/>
                <div id="pages">{$page}</div>
            </div>
        </div>
    </form>
</div>
<script language="javascript">
    $(function(){
        //从其他页面（如上传新题页面）跳转到此页面后，需要调用一下父窗口的_MP方法，才能保证样式和targetUrl是当前页面
        var controller = "{$controller}";
        var menuid = 0;
        if(controller=='Ad'){
            menuid = 154;
        }else if(controller=='SellerList'){
            menuid = 143;
        }else if(controller=='Article'){
            menuid = 106;
        }
        var src = $("#rightMain",parent.document).attr('src');
        var targetUrl = "/admin.php?m="+controller+"&a=my";
        if(src!=targetUrl){
            parent._MP(menuid,targetUrl);
        }
        buttonStyle();
        getPointList();
    });
    $("#myUpload").click(function(){
        $("#upload").val('1');
        $("#download").val('0');
        $("#collect").val('0');
        buttonStyle();
        $("#searchform").submit();
    });
    $("#myDownload").click(function(){
        $("#download").val('1');
        $("#upload").val('0');
        $("#collect").val('0');
        buttonStyle();
        $("#searchform").submit();
    });
    $("#myCollect").click(function(){
        $("#collect").val('1');
        $("#upload").val('0');
        $("#download").val('0');
        buttonStyle();
        $("#searchform").submit();
    });
    function buttonStyle(){
        var upload = $("#upload").val();
        var download = $("#download").val();
        var collect = $("#collect").val();
        if(upload=='1'){
            $("#myUpload").removeClass("myqn");
            $("#myUpload").addClass("myqnclick");
        }else{
            $("#myUpload").removeClass("myqnclick");
            $("#myUpload").addClass("myqn");
        }
        if(download=='1'){
            $("#myDownload").removeClass("myqn");
            $("#myDownload").addClass("myqnclick");
        }else{
            $("#myDownload").removeClass("myqnclick");
            $("#myDownload").addClass("myqn");
        }
        if(collect=='1'){
            $("#myCollect").removeClass("myqn");
            $("#myCollect").addClass("myqnclick");
        }else{
            $("#myCollect").removeClass("myqnclick");
            $("#myCollect").addClass("myqn");
        }

    }
    //重置
    function clean(){
        $("#grade_id").val('');
        $("#cate_id").val('');
        $("#searchform").submit();
    }
    //判断年级和学科有没有选择
    function isChecked(){
        var grade_id = $("#grade_id").val();
        var cate_id = $("#cate_id").val();
        if(grade_id == ""){
            alert("请先选择年级！");
            return false;
        }
        if(cate_id == ""){
            alert("请先选择学科！");
            return false;
        }
    }
    //获取知识点列表
    function getPointList(){
        var grade_id = $("#grade_id").val();
        var cate_id = $("#cate_id").val();
        if(grade_id!='' && cate_id!=''){
            var url = "admin.php?m={$controller}&a=getPointList";
            $.get(url, { grade_id: grade_id, cate_id: cate_id }, function(jsondata){
                //搜索和重置按钮复原
                var submit = $("#submit").html();
                if(submit==''){
                    submit = "<span style='margin-left:20px;'></span>" +
                    "<input type='submit' name='search' class='button' value='搜索' />&nbsp; " +
                    "<input type='button' class='button' value='重置' onclick='clean()'/>";
                    $("#submit").html(submit);
                }
                //知识点条件搜索栏置空
                $("#point_list").html('');
                $("#point_list").removeClass('explain-col');
                //若选中的年级和学科下有知识点，则显示
                if(jsondata!=''){
                    var submit = $("#submit").html();
                    $("#submit").html('');
                    $("#point_list").html('');
                    $("#point_list").addClass('explain-col');
                    var point_list = "知识点：&nbsp;";
                    $.each(jsondata,function(idx,obj){
                        point_list += "<input type='checkbox' name='point_id[]' id='point_"+obj.id+"' value='"+obj.alias+"' "+{$checked}[obj.alias]+"/>";
                        point_list += "<label for='point_"+obj.id+"'>"+obj.name+"</label>&nbsp;&nbsp;&nbsp;&nbsp;";
                    });
                    //搜索和重置按钮调整位置，放所有搜索条件的后面
                    point_list += "<span id='search'>"+submit+"</span>";
                    $("#point_list").html(point_list);
                }
            });
        }
    }

    function checkQuestion(){
        var ids='';
        $("input[name='id[]']:checked").each(function(i, n){
            ids += $(n).val() + ',';
        });
        if(ids=='') {
            window.top.art.dialog({content:lang_please_select+'菜单分类名称	',lock:true,width:'200',height:'50',time:1.5},function(){});
            return false;
        }
        return true;
    }

    function statusQuestion(id,type){
        var url = "admin.php?m={$controller}&a=statusQuestion";
        $.get(url, { id: id, type: type }, function(jsondata){
            var return_data  = eval("("+jsondata+")");
            $("#"+type+"_"+id+" img").attr('src', '__ROOT__/statics/images/status_'+return_data+'.gif');
        });
    }
    //排序方法
    function sortQuestion(id,type,num){
        var url = "admin.php?m={$controller}&a=sortQuestion";
        $.get(url, { id: id, type: type,num:num }, function(jsondata){
            var return_data  = eval("("+jsondata+")");
            $("#"+type+"_"+id+" ").attr('value', return_data);
        });
    }
    //预览
    function lookQuestion(id) {
        location.href = "admin.php?m={$controller}&a=lookQuestion"+"&id="+id;
    }
    //编辑
    function editQuestion(id) {
        location.href = "admin.php?m={$controller}&a=editQuestion&display=my"+"&id="+id;
    }
    //收藏
    function collectQuestion(id) {
        var url = "admin.php?m={$controller}&a=collectQuestion";
        $.get(url, { id: id }, function(jsondata){
            window.top.art.dialog({id:'collectQuestion',content:jsondata.info,lock:true,width:'200',height:'50',time:1});
            if(jsondata.status==1){
                window.location.reload();
            }
        });
    }
    //下载
    function downloadQuestion(id) {
        var url = "admin.php?m={$controller}&a=downloadQuestion";
        $.get(url, { id: id }, function(jsondata){
            if(jsondata.status==2){
                if(confirm(jsondata.info)){
                    location.href = "download.php?id="+id+"&pid={$period_id}&tab={$question_tab}";
                }
            }else{
                $('#download_'+id).html("<span style='color:#009933;'>已下载</span>");
                location.href = "download.php?id="+id+"&pid={$period_id}&tab={$question_tab}";
            }
        });
    }
</script>
</body>
</html>